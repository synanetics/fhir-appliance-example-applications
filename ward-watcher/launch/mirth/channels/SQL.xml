<channelGroup version="3.11.0">
  <id>4acaa7fe-f288-4a03-ad0b-1a8152ad1f29</id>
  <name>SQL</name>
  <revision>1</revision>
  <lastModified>
    <time>1626715749132</time>
    <timezone>Etc/UTC</timezone>
  </lastModified>
  <description></description>
  <channels>
    <channel version="3.11.0">
      <id>5a9a42d4-b09b-44cb-b228-0582f59b9e49</id>
      <nextMetaDataId>2</nextMetaDataId>
      <name>SQL to FHIR Organizations</name>
      <description></description>
      <revision>1</revision>
      <sourceConnector version="3.11.0">
        <metaDataId>0</metaDataId>
        <name>sourceConnector</name>
        <properties class="com.mirth.connect.connectors.jdbc.DatabaseReceiverProperties" version="3.11.0">
          <pluginProperties/>
          <pollConnectorProperties version="3.11.0">
            <pollingType>INTERVAL</pollingType>
            <pollOnStart>true</pollOnStart>
            <pollingFrequency>10000</pollingFrequency>
            <pollingHour>0</pollingHour>
            <pollingMinute>0</pollingMinute>
            <cronJobs/>
            <pollConnectorPropertiesAdvanced>
              <weekly>true</weekly>
              <inactiveDays>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
              </inactiveDays>
              <dayOfMonth>1</dayOfMonth>
              <allDay>true</allDay>
              <startingHour>8</startingHour>
              <startingMinute>0</startingMinute>
              <endingHour>17</endingHour>
              <endingMinute>0</endingMinute>
            </pollConnectorPropertiesAdvanced>
          </pollConnectorProperties>
          <sourceConnectorProperties version="3.11.0">
            <responseVariable>Auto-generate (Before processing)</responseVariable>
            <respondAfterProcessing>true</respondAfterProcessing>
            <processBatch>false</processBatch>
            <firstResponse>false</firstResponse>
            <processingThreads>1</processingThreads>
            <resourceIds class="linked-hash-map">
              <entry>
                <string>Default Resource</string>
                <string>[Default Resource]</string>
              </entry>
            </resourceIds>
            <queueBufferSize>1000</queueBufferSize>
          </sourceConnectorProperties>
          <driver>com.microsoft.sqlserver.jdbc.SQLServerDriver</driver>
          <url>jdbc:sqlserver://host.docker.internal:1435;databaseName=MASTERDATA</url>
          <username>master_data</username>
          <password>5tMunG050nFh1R</password>
          <select>SELECT [ODS]
      ,[NAME]
      ,[ADDRESS_LINE_1]
      ,[CITY]
      ,[DISTRICT]
      ,[POSTCODE]
  FROM [dbo].[ORGANIZATIONS]
  WHERE PROCESSED = 0
 </select>
          <update>UPDATE [dbo].[ORGANIZATIONS] SET PROCESSED = 1 WHERE ODS = ${ods}</update>
          <useScript>false</useScript>
          <aggregateResults>false</aggregateResults>
          <cacheResults>false</cacheResults>
          <keepConnectionOpen>false</keepConnectionOpen>
          <updateMode>3</updateMode>
          <retryCount>3</retryCount>
          <retryInterval>10000</retryInterval>
          <fetchSize>1000</fetchSize>
          <encoding>DEFAULT_ENCODING</encoding>
        </properties>
        <transformer version="3.11.0">
          <elements/>
          <inboundTemplate encoding="base64">PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+DQo8cmVzdWx0Pg0KICAgIDxvZHM+dmFsdWU8L29kcz4NCiAgICA8bmFtZT52YWx1ZTwvbmFtZT4NCiAgICA8YWRkcmVzc19saW5lXzE+dmFsdWU8L2FkZHJlc3NfbGluZV8xPg0KICAgIDxjaXR5PnZhbHVlPC9jaXR5Pg0KICAgIDxkaXN0cmljdD52YWx1ZTwvZGlzdHJpY3Q+DQogICAgPHBvc3Rjb2RlPnZhbHVlPC9wb3N0Y29kZT4NCjwvcmVzdWx0Pg0K</inboundTemplate>
          <inboundDataType>XML</inboundDataType>
          <outboundDataType>XML</outboundDataType>
          <inboundProperties class="com.mirth.connect.plugins.datatypes.xml.XMLDataTypeProperties" version="3.11.0">
            <serializationProperties class="com.mirth.connect.plugins.datatypes.xml.XMLSerializationProperties" version="3.11.0">
              <stripNamespaces>false</stripNamespaces>
            </serializationProperties>
            <batchProperties class="com.mirth.connect.plugins.datatypes.xml.XMLBatchProperties" version="3.11.0">
              <splitType>Element_Name</splitType>
              <elementName></elementName>
              <level>1</level>
              <query></query>
              <batchScript></batchScript>
            </batchProperties>
          </inboundProperties>
          <outboundProperties class="com.mirth.connect.plugins.datatypes.xml.XMLDataTypeProperties" version="3.11.0">
            <serializationProperties class="com.mirth.connect.plugins.datatypes.xml.XMLSerializationProperties" version="3.11.0">
              <stripNamespaces>false</stripNamespaces>
            </serializationProperties>
            <batchProperties class="com.mirth.connect.plugins.datatypes.xml.XMLBatchProperties" version="3.11.0">
              <splitType>Element_Name</splitType>
              <elementName></elementName>
              <level>1</level>
              <query></query>
              <batchScript></batchScript>
            </batchProperties>
          </outboundProperties>
        </transformer>
        <filter version="3.11.0">
          <elements/>
        </filter>
        <transportName>Database Reader</transportName>
        <mode>SOURCE</mode>
        <enabled>true</enabled>
        <waitForPrevious>true</waitForPrevious>
      </sourceConnector>
      <destinationConnectors>
        <connector version="3.11.0">
          <metaDataId>1</metaDataId>
          <name>UPSERT Organizations</name>
          <properties class="com.mirth.connect.connectors.http.HttpDispatcherProperties" version="3.11.0">
            <pluginProperties/>
            <destinationConnectorProperties version="3.11.0">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <host>http://host.docker.internal:3880/fhir/stu3/Organization/${organizationResourceId}</host>
            <useProxyServer>false</useProxyServer>
            <proxyAddress></proxyAddress>
            <proxyPort></proxyPort>
            <method>put</method>
            <headers class="linked-hash-map">
              <entry>
                <string>api-key</string>
                <list>
                  <string>900a1cae-7b54-43da-9ef9-94087d6c1b81</string>
                </list>
              </entry>
            </headers>
            <parameters class="linked-hash-map"/>
            <useHeadersVariable>false</useHeadersVariable>
            <headersVariable></headersVariable>
            <useParametersVariable>false</useParametersVariable>
            <parametersVariable></parametersVariable>
            <responseXmlBody>false</responseXmlBody>
            <responseParseMultipart>true</responseParseMultipart>
            <responseIncludeMetadata>false</responseIncludeMetadata>
            <responseBinaryMimeTypes></responseBinaryMimeTypes>
            <responseBinaryMimeTypesRegex>false</responseBinaryMimeTypesRegex>
            <multipart>false</multipart>
            <useAuthentication>false</useAuthentication>
            <authenticationType>Basic</authenticationType>
            <usePreemptiveAuthentication>false</usePreemptiveAuthentication>
            <username></username>
            <password></password>
            <content>${message.encodedData}</content>
            <contentType>application/fhir+json</contentType>
            <dataTypeBinary>false</dataTypeBinary>
            <charset>UTF-8</charset>
            <socketTimeout>30000</socketTimeout>
          </properties>
          <transformer version="3.11.0">
            <elements>
              <com.mirth.connect.plugins.messagebuilder.MessageBuilderStep version="3.11.0">
                <name>identifier [0] - value (out) &lt;-- ods (in)</name>
                <sequenceNumber>0</sequenceNumber>
                <enabled>true</enabled>
                <messageSegment>tmp[&apos;identifier&apos;][0][&apos;value&apos;]</messageSegment>
                <mapping>msg[&apos;ods&apos;].toString()</mapping>
                <defaultValue></defaultValue>
                <replacements/>
              </com.mirth.connect.plugins.messagebuilder.MessageBuilderStep>
              <com.mirth.connect.plugins.messagebuilder.MessageBuilderStep version="3.11.0">
                <name>name (out) &lt;-- name (in)</name>
                <sequenceNumber>1</sequenceNumber>
                <enabled>true</enabled>
                <messageSegment>tmp[&apos;name&apos;]</messageSegment>
                <mapping>msg[&apos;name&apos;].toString()</mapping>
                <defaultValue></defaultValue>
                <replacements/>
              </com.mirth.connect.plugins.messagebuilder.MessageBuilderStep>
              <com.mirth.connect.plugins.messagebuilder.MessageBuilderStep version="3.11.0">
                <name>address [0] - postalCode (out) &lt;-- postcode (in)</name>
                <sequenceNumber>2</sequenceNumber>
                <enabled>true</enabled>
                <messageSegment>tmp[&apos;address&apos;][0][&apos;postalCode&apos;]</messageSegment>
                <mapping>msg[&apos;postcode&apos;].toString()</mapping>
                <defaultValue></defaultValue>
                <replacements/>
              </com.mirth.connect.plugins.messagebuilder.MessageBuilderStep>
              <com.mirth.connect.plugins.messagebuilder.MessageBuilderStep version="3.11.0">
                <name>address [0] - district (out) &lt;-- district (in)</name>
                <sequenceNumber>3</sequenceNumber>
                <enabled>true</enabled>
                <messageSegment>tmp[&apos;address&apos;][0][&apos;district&apos;]</messageSegment>
                <mapping>msg[&apos;district&apos;].toString()</mapping>
                <defaultValue></defaultValue>
                <replacements/>
              </com.mirth.connect.plugins.messagebuilder.MessageBuilderStep>
              <com.mirth.connect.plugins.messagebuilder.MessageBuilderStep version="3.11.0">
                <name>address [0] - city (out) &lt;-- city (in)</name>
                <sequenceNumber>4</sequenceNumber>
                <enabled>true</enabled>
                <messageSegment>tmp[&apos;address&apos;][0][&apos;city&apos;]</messageSegment>
                <mapping>msg[&apos;city&apos;].toString()</mapping>
                <defaultValue></defaultValue>
                <replacements/>
              </com.mirth.connect.plugins.messagebuilder.MessageBuilderStep>
              <com.mirth.connect.plugins.messagebuilder.MessageBuilderStep version="3.11.0">
                <name>address [0] - line [0] -  (out) &lt;-- address_line_1 (in)</name>
                <sequenceNumber>5</sequenceNumber>
                <enabled>true</enabled>
                <messageSegment>tmp[&apos;address&apos;][0][&apos;line&apos;][0]</messageSegment>
                <mapping>msg[&apos;address_line_1&apos;].toString()</mapping>
                <defaultValue></defaultValue>
                <replacements/>
              </com.mirth.connect.plugins.messagebuilder.MessageBuilderStep>
              <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.11.0">
                <name>set organization resource id</name>
                <sequenceNumber>6</sequenceNumber>
                <enabled>true</enabled>
                <script>//If an id map entry exists for this nhs number then use it, else create one
var ods = msg[&apos;ods&apos;].toString();
var organizationResourceId = globalMap.get(ods);
if(!organizationResourceId)
{
	organizationResourceId = UUIDGenerator.getUUID();
	globalMap.put(ods, organizationResourceId);
}
//Update reference data for this org
globalMap.put(organizationResourceId, msg[&apos;name&apos;].toString());
//Add id to channel map
channelMap.put(&apos;organizationResourceId&apos;,organizationResourceId);
//Set id property on outbound FHIR resource...
tmp[&apos;id&apos;] = organizationResourceId;</script>
              </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
            </elements>
            <inboundTemplate encoding="base64">PHJlc3VsdD4NCiAgICA8Y2l0eT5TT01FUlRPTjwvY2l0eT4NCiAgICA8ZGlzdHJpY3Q+U09NRVJTRVQ8L2Rpc3RyaWN0Pg0KICAgIDxuYW1lPkJVVFRFUkNST1NTIEhFQUxUSCBDRU5UUkU8L25hbWU+DQogICAgPGFkZHJlc3NfbGluZV8xPkJFSElORCBCRVJSWTwvYWRkcmVzc19saW5lXzE+DQogICAgPHBvc3Rjb2RlPlRBMTEgN1BCPC9wb3N0Y29kZT4NCiAgICA8b2RzPkw4NTA2Njwvb2RzPg0KPC9yZXN1bHQ+DQo=</inboundTemplate>
            <outboundTemplate encoding="base64">ewogICAgInJlc291cmNlVHlwZSI6ICJPcmdhbml6YXRpb24iLAogICAgImlkIjogIiIsCiAgICAibWV0YSI6IHsKICAgICAgICAicHJvZmlsZSI6IFsKICAgICAgICAgICAgImh0dHBzOi8vZmhpci5obDcub3JnLnVrL1NUVTMvU3RydWN0dXJlRGVmaW5pdGlvbi9DYXJlQ29ubmVjdC1Pcmdhbml6YXRpb24tMSIKICAgICAgICBdCiAgICB9LAogICAgImlkZW50aWZpZXIiOiBbCiAgICAgICAgewogICAgICAgICAgICAic3lzdGVtIjogImh0dHBzOi8vZmhpci5uaHMudWsvSWQvb2RzLW9yZ2FuaXphdGlvbi1jb2RlIiwKICAgICAgICAgICAgInZhbHVlIjogIiIKICAgICAgICB9CiAgICBdLAogICAgInR5cGUiOiBbCiAgICAgICAgewogICAgICAgICAgICAiY29kaW5nIjogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJzeXN0ZW0iOiAiaHR0cDovL2hsNy5vcmcvZmhpci9vcmdhbml6YXRpb24tdHlwZSIsCiAgICAgICAgICAgICAgICAgICAgImNvZGUiOiAicHJvdiIsCiAgICAgICAgICAgICAgICAgICAgImRpc3BsYXkiOiAiSGVhbHRoY2FyZSBQcm92aWRlciIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXQogICAgICAgIH0KICAgIF0sCgkiYWRkcmVzcyI6IFsKICAgICAgICB7CiAgICAgICAgICAgICJsaW5lIjogWwogICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgXSwKICAgICAgICAgICAgImNpdHkiOiAiIiwKICAgICAgICAgICAgImRpc3RyaWN0IjogIiIsCiAgICAgICAgICAgICJwb3N0YWxDb2RlIjogIiIKICAgICAgICB9CiAgICBdLAogICAgIm5hbWUiOiAiIgp9</outboundTemplate>
            <inboundDataType>XML</inboundDataType>
            <outboundDataType>FHIR</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.xml.XMLDataTypeProperties" version="3.11.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.xml.XMLSerializationProperties" version="3.11.0">
                <stripNamespaces>false</stripNamespaces>
              </serializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.xml.XMLBatchProperties" version="3.11.0">
                <splitType>Element_Name</splitType>
                <elementName></elementName>
                <level>1</level>
                <query></query>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.11.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.11.0">
                <serializationType>JSON</serializationType>
                <fhirVersion>STU3</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.11.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.11.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.11.0">
            <elements/>
            <inboundDataType>FHIR</inboundDataType>
            <outboundDataType>FHIR</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.11.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.11.0">
                <serializationType>JSON</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.11.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.11.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.11.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.11.0">
                <serializationType>JSON</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.11.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.11.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.11.0">
            <elements/>
          </filter>
          <transportName>HTTP Sender</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
      </destinationConnectors>
      <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
      <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
      <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
      <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
      <properties version="3.11.0">
        <clearGlobalChannelMap>false</clearGlobalChannelMap>
        <messageStorageMode>DEVELOPMENT</messageStorageMode>
        <encryptData>false</encryptData>
        <removeContentOnCompletion>false</removeContentOnCompletion>
        <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
        <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
        <initialState>STOPPED</initialState>
        <storeAttachments>true</storeAttachments>
        <metaDataColumns>
          <metaDataColumn>
            <name>SOURCE</name>
            <type>STRING</type>
            <mappingName>mirth_source</mappingName>
          </metaDataColumn>
          <metaDataColumn>
            <name>TYPE</name>
            <type>STRING</type>
            <mappingName>mirth_type</mappingName>
          </metaDataColumn>
        </metaDataColumns>
        <attachmentProperties version="3.11.0">
          <type>None</type>
          <properties/>
        </attachmentProperties>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
      </properties>
      <exportData>
        <metadata>
          <enabled>true</enabled>
          <lastModified>
            <time>1626714889680</time>
            <timezone>Europe/London</timezone>
          </lastModified>
          <pruningSettings>
            <archiveEnabled>true</archiveEnabled>
          </pruningSettings>
        </metadata>
      </exportData>
    </channel>
    <channel version="3.11.0">
      <id>467a7735-07e3-4d3a-ad62-371611642a8d</id>
      <nextMetaDataId>3</nextMetaDataId>
      <name>SQL to FHIR Practitioners</name>
      <description></description>
      <revision>3</revision>
      <sourceConnector version="3.11.0">
        <metaDataId>0</metaDataId>
        <name>sourceConnector</name>
        <properties class="com.mirth.connect.connectors.jdbc.DatabaseReceiverProperties" version="3.11.0">
          <pluginProperties/>
          <pollConnectorProperties version="3.11.0">
            <pollingType>INTERVAL</pollingType>
            <pollOnStart>true</pollOnStart>
            <pollingFrequency>10000</pollingFrequency>
            <pollingHour>0</pollingHour>
            <pollingMinute>0</pollingMinute>
            <cronJobs/>
            <pollConnectorPropertiesAdvanced>
              <weekly>true</weekly>
              <inactiveDays>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
                <boolean>false</boolean>
              </inactiveDays>
              <dayOfMonth>1</dayOfMonth>
              <allDay>true</allDay>
              <startingHour>8</startingHour>
              <startingMinute>0</startingMinute>
              <endingHour>17</endingHour>
              <endingMinute>0</endingMinute>
            </pollConnectorPropertiesAdvanced>
          </pollConnectorProperties>
          <sourceConnectorProperties version="3.11.0">
            <responseVariable>Auto-generate (Before processing)</responseVariable>
            <respondAfterProcessing>true</respondAfterProcessing>
            <processBatch>false</processBatch>
            <firstResponse>false</firstResponse>
            <processingThreads>1</processingThreads>
            <resourceIds class="linked-hash-map">
              <entry>
                <string>Default Resource</string>
                <string>[Default Resource]</string>
              </entry>
            </resourceIds>
            <queueBufferSize>1000</queueBufferSize>
          </sourceConnectorProperties>
          <driver>com.microsoft.sqlserver.jdbc.SQLServerDriver</driver>
          <url>jdbc:sqlserver://host.docker.internal:1435;databaseName=MASTERDATA</url>
          <username>master_data</username>
          <password>5tMunG050nFh1R</password>
          <select>SELECT [GMC]
      ,[FAMILY]
      ,[GIVEN]
      ,[PREFIX]
      ,[GENDER]
  FROM [dbo].[PRACTITIONERS]
  WHERE PROCESSED = 0
 </select>
          <update>UPDATE [dbo].[PRACTITIONERS] SET PROCESSED = 1 WHERE GMC = ${gmc}</update>
          <useScript>false</useScript>
          <aggregateResults>false</aggregateResults>
          <cacheResults>false</cacheResults>
          <keepConnectionOpen>false</keepConnectionOpen>
          <updateMode>3</updateMode>
          <retryCount>3</retryCount>
          <retryInterval>10000</retryInterval>
          <fetchSize>1000</fetchSize>
          <encoding>DEFAULT_ENCODING</encoding>
        </properties>
        <transformer version="3.11.0">
          <elements/>
          <inboundTemplate encoding="base64">PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+DQo8cmVzdWx0Pg0KICAgIDxnbWM+dmFsdWU8L2dtYz4NCiAgICA8ZmFtaWx5PnZhbHVlPC9mYW1pbHk+DQogICAgPGdpdmVuPnZhbHVlPC9naXZlbj4NCiAgICA8cHJlZml4PnZhbHVlPC9wcmVmaXg+DQogICAgPGdlbmRlcj52YWx1ZTwvZ2VuZGVyPg0KPC9yZXN1bHQ+DQo=</inboundTemplate>
          <inboundDataType>XML</inboundDataType>
          <outboundDataType>XML</outboundDataType>
          <inboundProperties class="com.mirth.connect.plugins.datatypes.xml.XMLDataTypeProperties" version="3.11.0">
            <serializationProperties class="com.mirth.connect.plugins.datatypes.xml.XMLSerializationProperties" version="3.11.0">
              <stripNamespaces>false</stripNamespaces>
            </serializationProperties>
            <batchProperties class="com.mirth.connect.plugins.datatypes.xml.XMLBatchProperties" version="3.11.0">
              <splitType>Element_Name</splitType>
              <elementName></elementName>
              <level>1</level>
              <query></query>
              <batchScript></batchScript>
            </batchProperties>
          </inboundProperties>
          <outboundProperties class="com.mirth.connect.plugins.datatypes.xml.XMLDataTypeProperties" version="3.11.0">
            <serializationProperties class="com.mirth.connect.plugins.datatypes.xml.XMLSerializationProperties" version="3.11.0">
              <stripNamespaces>false</stripNamespaces>
            </serializationProperties>
            <batchProperties class="com.mirth.connect.plugins.datatypes.xml.XMLBatchProperties" version="3.11.0">
              <splitType>Element_Name</splitType>
              <elementName></elementName>
              <level>1</level>
              <query></query>
              <batchScript></batchScript>
            </batchProperties>
          </outboundProperties>
        </transformer>
        <filter version="3.11.0">
          <elements/>
        </filter>
        <transportName>Database Reader</transportName>
        <mode>SOURCE</mode>
        <enabled>true</enabled>
        <waitForPrevious>true</waitForPrevious>
      </sourceConnector>
      <destinationConnectors>
        <connector version="3.11.0">
          <metaDataId>1</metaDataId>
          <name>UPSERT Practitioners</name>
          <properties class="com.mirth.connect.connectors.http.HttpDispatcherProperties" version="3.11.0">
            <pluginProperties/>
            <destinationConnectorProperties version="3.11.0">
              <queueEnabled>false</queueEnabled>
              <sendFirst>false</sendFirst>
              <retryIntervalMillis>10000</retryIntervalMillis>
              <regenerateTemplate>false</regenerateTemplate>
              <retryCount>0</retryCount>
              <rotate>false</rotate>
              <includeFilterTransformer>false</includeFilterTransformer>
              <threadCount>1</threadCount>
              <threadAssignmentVariable></threadAssignmentVariable>
              <validateResponse>false</validateResponse>
              <resourceIds class="linked-hash-map">
                <entry>
                  <string>Default Resource</string>
                  <string>[Default Resource]</string>
                </entry>
              </resourceIds>
              <queueBufferSize>1000</queueBufferSize>
              <reattachAttachments>true</reattachAttachments>
            </destinationConnectorProperties>
            <host>http://host.docker.internal:3880/fhir/stu3/Practitioner/${practitionerResourceId}</host>
            <useProxyServer>false</useProxyServer>
            <proxyAddress></proxyAddress>
            <proxyPort></proxyPort>
            <method>put</method>
            <headers class="linked-hash-map">
              <entry>
                <string>api-key</string>
                <list>
                  <string>900a1cae-7b54-43da-9ef9-94087d6c1b81</string>
                </list>
              </entry>
            </headers>
            <parameters class="linked-hash-map"/>
            <useHeadersVariable>false</useHeadersVariable>
            <headersVariable></headersVariable>
            <useParametersVariable>false</useParametersVariable>
            <parametersVariable></parametersVariable>
            <responseXmlBody>false</responseXmlBody>
            <responseParseMultipart>true</responseParseMultipart>
            <responseIncludeMetadata>false</responseIncludeMetadata>
            <responseBinaryMimeTypes></responseBinaryMimeTypes>
            <responseBinaryMimeTypesRegex>false</responseBinaryMimeTypesRegex>
            <multipart>false</multipart>
            <useAuthentication>false</useAuthentication>
            <authenticationType>Basic</authenticationType>
            <usePreemptiveAuthentication>false</usePreemptiveAuthentication>
            <username></username>
            <password></password>
            <content>${message.encodedData}</content>
            <contentType>application/fhir+json</contentType>
            <dataTypeBinary>false</dataTypeBinary>
            <charset>UTF-8</charset>
            <socketTimeout>30000</socketTimeout>
          </properties>
          <transformer version="3.11.0">
            <elements>
              <com.mirth.connect.plugins.messagebuilder.MessageBuilderStep version="3.11.0">
                <name>identifier [0] - value (out) &lt;-- gmc (in)</name>
                <sequenceNumber>0</sequenceNumber>
                <enabled>true</enabled>
                <messageSegment>tmp[&apos;identifier&apos;][0][&apos;value&apos;]</messageSegment>
                <mapping>msg[&apos;gmc&apos;].toString()</mapping>
                <defaultValue></defaultValue>
                <replacements/>
              </com.mirth.connect.plugins.messagebuilder.MessageBuilderStep>
              <com.mirth.connect.plugins.messagebuilder.MessageBuilderStep version="3.11.0">
                <name>name [0] - given [0] -  (out) &lt;-- given (in)</name>
                <sequenceNumber>1</sequenceNumber>
                <enabled>true</enabled>
                <messageSegment>tmp[&apos;name&apos;][0][&apos;given&apos;][0]</messageSegment>
                <mapping>msg[&apos;given&apos;].toString()</mapping>
                <defaultValue></defaultValue>
                <replacements/>
              </com.mirth.connect.plugins.messagebuilder.MessageBuilderStep>
              <com.mirth.connect.plugins.messagebuilder.MessageBuilderStep version="3.11.0">
                <name>name [0] - family (out) &lt;-- family (in)</name>
                <sequenceNumber>2</sequenceNumber>
                <enabled>true</enabled>
                <messageSegment>tmp[&apos;name&apos;][0][&apos;family&apos;]</messageSegment>
                <mapping>msg[&apos;family&apos;].toString()</mapping>
                <defaultValue></defaultValue>
                <replacements/>
              </com.mirth.connect.plugins.messagebuilder.MessageBuilderStep>
              <com.mirth.connect.plugins.messagebuilder.MessageBuilderStep version="3.11.0">
                <name>name [0] - prefix [0] -  (out) &lt;-- prefix (in)</name>
                <sequenceNumber>3</sequenceNumber>
                <enabled>true</enabled>
                <messageSegment>tmp[&apos;name&apos;][0][&apos;prefix&apos;][0]</messageSegment>
                <mapping>msg[&apos;prefix&apos;].toString()</mapping>
                <defaultValue></defaultValue>
                <replacements/>
              </com.mirth.connect.plugins.messagebuilder.MessageBuilderStep>
              <com.mirth.connect.plugins.messagebuilder.MessageBuilderStep version="3.11.0">
                <name>gender (out) &lt;-- gender (in)</name>
                <sequenceNumber>4</sequenceNumber>
                <enabled>true</enabled>
                <messageSegment>tmp[&apos;gender&apos;]</messageSegment>
                <mapping>msg[&apos;gender&apos;].toString()</mapping>
                <defaultValue></defaultValue>
                <replacements/>
              </com.mirth.connect.plugins.messagebuilder.MessageBuilderStep>
              <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.11.0">
                <name>set practitioner resource id</name>
                <sequenceNumber>5</sequenceNumber>
                <enabled>true</enabled>
                <script>//If an id map entry exists for this nhs number then use it, else create one
var gmc = msg[&apos;gmc&apos;].toString();
var practitionerResourceId = globalMap.get(gmc);
if(!practitionerResourceId)
{
	practitionerResourceId = UUIDGenerator.getUUID();
	globalMap.put(gmc, practitionerResourceId);
}
//Update reference data for this practitioner
globalMap.put(practitionerResourceId, msg[&apos;prefix&apos;].toString() + &quot; &quot; + msg[&apos;given&apos;].toString() + &quot; &quot; + msg[&apos;family&apos;].toString());
//Add id to channel map
channelMap.put(&apos;practitionerResourceId&apos;,practitionerResourceId);
//Set id property on outbound FHIR resource...
tmp[&apos;id&apos;] = practitionerResourceId;</script>
              </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
            </elements>
            <inboundTemplate encoding="base64">PHJlc3VsdD4NCiAgICA8Z2l2ZW4+U1RBTk5JUzwvZ2l2ZW4+DQogICAgPHByZWZpeD5EUi48L3ByZWZpeD4NCiAgICA8Z21jPkc5OTk5OTI8L2dtYz4NCiAgICA8ZmFtaWx5PkJBUkFUSEVPTjwvZmFtaWx5Pg0KCTxnZW5kZXI+bWFsZTwvZ2VuZGVyPgo8L3Jlc3VsdD4N</inboundTemplate>
            <outboundTemplate encoding="base64">ewogICAgInJlc291cmNlVHlwZSI6ICJQcmFjdGl0aW9uZXIiLAogICAgImlkIjoiIiwKICAgICJtZXRhIjogewogICAgICAgICJwcm9maWxlIjogWwogICAgICAgICAgICAiaHR0cHM6Ly9maGlyLmhsNy5vcmcudWsvU1RVMy9TdHJ1Y3R1cmVEZWZpbml0aW9uL0NhcmVDb25uZWN0LVByYWN0aXRpb25lci0xIgogICAgICAgIF0KICAgIH0sCiAgICAiaWRlbnRpZmllciI6IFsKICAgICAgICB7CiAgICAgICAgICAgICJzeXN0ZW0iOiAiaHR0cHM6Ly9maGlyLm5ocy51ay9JZC9zZHMtdXNlci1pZCIsCiAgICAgICAgICAgICJ2YWx1ZSI6ICIiCiAgICAgICAgfQogICAgXSwKICAgICJuYW1lIjogWwogICAgICAgIHsKICAgICAgICAgICAgImZhbWlseSI6ICIiLAogICAgICAgICAgICAiZ2l2ZW4iOiBbCiAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICBdLAogICAgICAgICAgICAicHJlZml4IjogWwogICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgXQogICAgICAgIH0KICAgIF0sCiAgICAidGVsZWNvbSI6IFsKICAgICAgICB7CiAgICAgICAgICAgICJzeXN0ZW0iOiAiZW1haWwiLAogICAgICAgICAgICAidmFsdWUiOiAiYWJoYXRpYUBuaHMuc2t5bmV0IiwKICAgICAgICAgICAgInVzZSI6ICJ3b3JrIgogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICAic3lzdGVtIjogInBob25lIiwKICAgICAgICAgICAgInZhbHVlIjogIjAxMTUgOTczNzMyMCIsCiAgICAgICAgICAgICJ1c2UiOiAid29yayIKICAgICAgICB9CiAgICBdLAogICAgImFkZHJlc3MiOiBbCiAgICAgICAgewogICAgICAgICAgICAibGluZSI6IFsKICAgICAgICAgICAgICAgICJSZWdlbnQgU3RyZWV0IiwKICAgICAgICAgICAgICAgICJMb25nIEVhdG9uIgogICAgICAgICAgICBdLAogICAgICAgICAgICAiY2l0eSI6ICJOb3R0aW5naGFtIiwKICAgICAgICAgICAgImRpc3RyaWN0IjogIkRlcmJ5c2hpcmUiLAogICAgICAgICAgICAicG9zdGFsQ29kZSI6ICJORzEwIDFRUSIKICAgICAgICB9CiAgICBdLAogICAgImdlbmRlciI6ICJmZW1hbGUiCn0=</outboundTemplate>
            <inboundDataType>XML</inboundDataType>
            <outboundDataType>FHIR</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.xml.XMLDataTypeProperties" version="3.11.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.xml.XMLSerializationProperties" version="3.11.0">
                <stripNamespaces>false</stripNamespaces>
              </serializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.xml.XMLBatchProperties" version="3.11.0">
                <splitType>Element_Name</splitType>
                <elementName></elementName>
                <level>1</level>
                <query></query>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.11.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.11.0">
                <serializationType>JSON</serializationType>
                <fhirVersion>STU3</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.11.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.11.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </transformer>
          <responseTransformer version="3.11.0">
            <elements/>
            <inboundDataType>FHIR</inboundDataType>
            <outboundDataType>FHIR</outboundDataType>
            <inboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.11.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.11.0">
                <serializationType>JSON</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.11.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.11.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </inboundProperties>
            <outboundProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDataTypeProperties" version="3.11.0">
              <serializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirSerializationProperties" version="3.11.0">
                <serializationType>JSON</serializationType>
                <fhirVersion>R4</fhirVersion>
              </serializationProperties>
              <deserializationProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirDeserializationProperties" version="3.11.0">
                <serializationType>JSON</serializationType>
              </deserializationProperties>
              <batchProperties class="com.mirth.connect.plugins.datatypes.fhir.shared.FhirBatchProperties" version="3.11.0">
                <splitType>JavaScript</splitType>
                <batchScript></batchScript>
              </batchProperties>
            </outboundProperties>
          </responseTransformer>
          <filter version="3.11.0">
            <elements/>
          </filter>
          <transportName>HTTP Sender</transportName>
          <mode>DESTINATION</mode>
          <enabled>true</enabled>
          <waitForPrevious>true</waitForPrevious>
        </connector>
      </destinationConnectors>
      <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
      <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
      <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
      <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
      <properties version="3.11.0">
        <clearGlobalChannelMap>false</clearGlobalChannelMap>
        <messageStorageMode>DEVELOPMENT</messageStorageMode>
        <encryptData>false</encryptData>
        <removeContentOnCompletion>false</removeContentOnCompletion>
        <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
        <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
        <initialState>STOPPED</initialState>
        <storeAttachments>true</storeAttachments>
        <metaDataColumns>
          <metaDataColumn>
            <name>SOURCE</name>
            <type>STRING</type>
            <mappingName>mirth_source</mappingName>
          </metaDataColumn>
          <metaDataColumn>
            <name>TYPE</name>
            <type>STRING</type>
            <mappingName>mirth_type</mappingName>
          </metaDataColumn>
        </metaDataColumns>
        <attachmentProperties version="3.11.0">
          <type>None</type>
          <properties/>
        </attachmentProperties>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
      </properties>
      <exportData>
        <metadata>
          <enabled>true</enabled>
          <lastModified>
            <time>1626715952972</time>
            <timezone>Europe/London</timezone>
          </lastModified>
          <pruningSettings>
            <archiveEnabled>true</archiveEnabled>
          </pruningSettings>
        </metadata>
      </exportData>
    </channel>
  </channels>
</channelGroup>